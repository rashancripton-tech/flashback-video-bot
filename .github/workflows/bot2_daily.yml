name: Bot 2 - Processar V√≠deo Di√°rio

on:
  schedule:
    - cron: '0 12 * * *'  # Todo dia ao meio-dia UTC (9h BRT)
  workflow_dispatch:  # Permite execu√ß√£o manual

permissions:
  contents: write

jobs:
  processar-video:
    runs-on: ubuntu-22.04  # ‚úÖ UBUNTU 22.04 para compatibilidade com WARP
    
    steps:
      - name: Checkout reposit√≥rio
        uses: actions/checkout@v4
      
      # ‚ö†Ô∏è WARP para bypass do bloqueio do YouTube
      - name: Configurar WARP (bypass YouTube)
        uses: fscarmen/warp-on-actions@v1.3
        with:
          stack: dual
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Instalar depend√™ncias
        run: |
          pip install yt-dlp requests
          sudo apt-get update
          sudo apt-get install -y ffmpeg
      
      - name: Processar v√≠deo
        id: processar
        run: |
          python3 << 'EOF'
          import yt_dlp
          import json
          import subprocess
          import os
          import sys

          print("üé¨ Iniciando processamento de v√≠deo...")

          # Verificar se existe lista de v√≠deos
          if not os.path.exists('videos-lista.json'):
              print("‚ùå Arquivo videos-lista.json n√£o encontrado!")
              print("‚ö†Ô∏è Execute o Bot 1 primeiro para gerar a lista de v√≠deos.")
              sys.exit(1)

          # Ler lista de v√≠deos
          with open('videos-lista.json', 'r', encoding='utf-8') as f:
              videos = json.load(f)

          # Encontrar pr√≥ximo v√≠deo n√£o processado
          video = None
          for v in videos:
              if not v.get('processado', False):
                  video = v
                  break

          if not video:
              print("‚úÖ N√£o h√° v√≠deos pendentes!")
              sys.exit(0)

          print(f"\nüìπ V√≠deo selecionado:")
          print(f"   üé§ Artista: {video['artista']}")
          print(f"   üéµ T√≠tulo: {video['titulo']}")
          print(f"   ‚è±Ô∏è Dura√ß√£o: {video['duracao']}s")
          print(f"   üîó URL: {video['url']}")

          # Baixar v√≠deo do YouTube
          print("\n‚¨áÔ∏è Baixando v√≠deo do YouTube...")
          ydl_opts = {
              'format': 'bestvideo[height<=1080][ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]/best',
              'outtmpl': 'video-original.%(ext)s',
              'merge_output_format': 'mp4',
              'quiet': False,
              'no_warnings': False,
          }

          try:
              with yt_dlp.YoutubeDL(ydl_opts) as ydl:
                  ydl.download([video['url']])
              print("‚úÖ Download conclu√≠do!")
          except Exception as e:
              print(f"‚ùå Erro no download: {e}")
              sys.exit(1)

          # Verificar se arquivo foi baixado
          if not os.path.exists('video-original.mp4'):
              print("‚ùå Arquivo de v√≠deo n√£o foi baixado!")
              sys.exit(1)

          # Converter para vertical 90s
          print("\nüé® Convertendo para formato vertical (1080x1920, 90s)...")
          comando_ffmpeg 
